# Integraflow Codegen Test

This custom [graphql-code-generator](https://graphql-code-generator.com/) plugin takes the Integraflow GraphQL GraphQL [fragments and operations](../client/src/_generated_documents.graphql), generated by the [Integraflow Codegen Document](../codegen-doc/README.md), and outputs a typed [jest test](../client/src/_tests/_generated.test.ts). This aims to tests exposes all GraphQL models and operations available on the introspection query.

Usage must contain a neighbouring [test-client](../client/src/_tests/test-client.ts) file to expose two functions:
- `startClient` to optionally start a mock GraphQL server, used in the `beforeAll` hook
- `stopClient` to optionally stop a mock GraphQL server, used in the `afterAll` hook

It requires that GraphQL [types-document-nodes](https://github.com/dotansimha/graphql-typed-document-node) have been generated and linked to this plugin using the codegen config `documentFile` property, using the plugins:
- [@graphql-codegen/typescript](https://graphql-code-generator.com/docs/plugins/typescript)
- [@graphql-codegen/typescript-operations](https://graphql-code-generator.com/docs/plugins/typescript-operations)
- [@graphql-codegen/typed-document-node](https://graphql-code-generator.com/docs/plugins/typed-document-node)

Usage in [codegen.test.yml](../client/codegen.test.yml).

## Output

The [@integraflow/client](../client/README.md) uses this code generator [plugin](./src/plugin.ts) to generate:

A describe block for each root query, that returns a model that is not an item of a collection, containing:
- a test to return the model, asserting the return type
- a test for each nested query on the model, or first item in a collection, asserting the return type

## Flow

1. The GraphQL schema is parsed using a reusable [ContextVisitor](../codegen-doc/src/context-visitor.ts) to provide consistent information across the Integraflow code generator plugins
2. The context is visited using the [ModelVisitor](../codegen-sdk/src/model-visitor.ts) to return a list of parsed Integraflow models
3. The models and context are [parsed](../codegen-sdk/src/parse-operation.ts) to return a map of all operations for each nested resource
4. The parsed models, operations and context are used to print [tests](./src/print-test.ts)
5. The printed tests are returned to be printed

<!-- AUTO-GENERATED-CONTENT:START (TEXT_SECTION:id=license&src=../../README.md) -->
## License

<br/>

Licensed under the [MIT License](./LICENSE).
<!-- AUTO-GENERATED-CONTENT:END -->
